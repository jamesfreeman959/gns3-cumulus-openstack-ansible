---
- name: Prepare target hosts
  hosts: all
  become: yes

  tasks:
    - name: Copy across root SSH key generated by bootstrap_ansible script
      authorized_key:
        user: root
        state: present
        key: "{{ lookup('file', '/root/.ssh/id_rsa.pub') }}"

    - name: Install aptitude for future use by Ansible apt module
      apt:
        name: aptitude
        state: latest
        update_cache: yes
        force_apt_get: yes

    - name: Update all packages
      apt:
        name: '*'
        state: latest
        update_cache: yes

    - name: Install supplemental packages
      apt:
        name:
          - bridge-utils 
          - debootstrap 
          - ifenslave 
          - ifenslave-2.6
          - lsof 
          - lvm2 
          - chrony
          - openssh-server
          - sudo 
          - tcpdump 
          - vlan 
          - python
        state: latest

    - name: Ensure chrony is running
      service:
        name: chrony
        state: started
        enabled: yes
        
